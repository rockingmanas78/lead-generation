generator client {
  provider        = "prisma-client-py"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  directUrl  = env("DIRECT_URL")
  extensions = [uuid_ossp(map: "uuid-ossp", schema: "extensions")]
}

model Plan {
  id       String        @id @default(uuid())
  code     String        @unique
  name     String
  versions PlanVersion[]
}

model PlanVersion {
  id             String         @id @default(dbgenerated("gen_random_uuid()"))
  planId         String
  version        Int
  zone           ZoneCode
  bucket         Experiment
  cadence        BillingCadence
  currency       String
  basePriceCents Int
  createdAt      DateTime       @default(now())
  components     Component[]
  Plan           Plan           @relation(fields: [planId], references: [id])
  prices         PriceId[]

  @@unique([planId, zone, bucket, cadence, version])
}

model Component {
  id            String      @id @default(dbgenerated("gen_random_uuid()"))
  planVersionId String
  metric        MeterMetric
  includedQty   Int
  capPeriod     CapPeriod
  overageCents  Int
  PlanVersion   PlanVersion @relation(fields: [planVersionId], references: [id])
}

model PriceId {
  id              String         @id @default(dbgenerated("(gen_random_uuid())::text"))
  planVersionId   String
  gateway         PaymentGateway
  price           Int?
  externalPriceId String
  gatewayPlanId   String?
  PlanVersion     PlanVersion    @relation(fields: [planVersionId], references: [id])

  @@unique([planVersionId, gateway])
}

model Tenant {
  id                 String               @id @default(uuid())
  name               String
  plan               PlanType             @default(FREE)
  createdAt          DateTime             @default(now())
  countryCode        String?
  zone               ZoneCode             @default(IN)
  deletedAt          DateTime?
  bulkEmailJobs      BulkEmailJob[]
  BulkSnippet        BulkSnippet[]
  CalendarConnection CalendarConnection[]
  CompanyProfile     CompanyProfile?
  Conversation       Conversation[]
  DomainIdentity     DomainIdentity[]
  campaigns          EmailCampaign[]
  EmailMessage       EmailMessage[]
  templates          EmailTemplate[]
  Feedback           Feedback[]
  InboundReceipt     InboundReceipt[]
  KnowledgeDocument  KnowledgeDocument[]
  leads              Lead[]
  jobs               LeadGenerationJob[]
  PaymentTransaction PaymentTransaction[]
  TenantOnboarding   TenantOnboarding?
  UsageCounter       UsageCounter[]
  UsageEvent         UsageEvent[]
  users              User[]
  WebsiteContent     WebsiteContent[]
}

model Subscription {
  id                 String               @id @default(uuid())
  tenantId           String
  planVersionId      String
  zone               ZoneCode
  status             String
  currentStart       DateTime
  currentEnd         DateTime
  brokerId           String?
  planPriceId        String?
  cycle              String?              @default("MONTHLY")
  nextBillingAt      DateTime?            @db.Timestamptz(6)
  provider           String?
  providerSubId      String?
  createdAt          DateTime             @default(now()) @db.Timestamptz(6)
  updatedAt          DateTime             @default(now()) @db.Timestamptz(6)
  providerCustId     String?
  cancelAtCycleEnd   Boolean?
  PaymentTransaction PaymentTransaction[]
  UsageCounter       UsageCounter[]
  UsageEvent         UsageEvent[]
}

model UsageEvent {
  id             BigInt        @id @default(autoincrement())
  tenantId       String
  metric         MeterMetric
  qty            Int
  recordedAt     DateTime      @default(now())
  subscriptionId String?
  idempotencyKey String?
  Subscription   Subscription? @relation(fields: [subscriptionId], references: [id], onUpdate: NoAction, map: "UsageEvent_subscription_fkey")
  Tenant         Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "UsageEvent_tenant_fkey")

  @@index([tenantId, recordedAt])
  @@index([tenantId, recordedAt], map: "UsageEvent_tenant_recordedAt_idx")
}

model DailyCapCounter {
  tenantId String
  date     DateTime
  metric   MeterMetric
  qty      Int

  @@id([tenantId, date, metric])
}

model CampaignLead {
  id         String        @id @default(uuid())
  campaignId String
  leadId     String
  createdAt  DateTime      @default(now())
  campaign   EmailCampaign @relation(fields: [campaignId], references: [id])
  lead       Lead          @relation(fields: [leadId], references: [id])

  @@unique([campaignId, leadId])
}

model User {
  id                 String               @id @default(uuid())
  tenantId           String
  email              String               @unique
  passwordHash       String
  role               UserRole             @default(MANAGER)
  verified           Boolean              @default(false)
  createdAt          DateTime             @default(now())
  deletedAt          DateTime?
  oauthProvider      String?              @db.VarChar(32)
  oauthId            String?
  name               String?              @db.VarChar(120)
  phoneNumber        String?              @db.VarChar(32)
  location           String?              @db.VarChar(120)
  bio                String?
  avatarUrl          String?
  CalendarConnection CalendarConnection[]
  tenant             Tenant               @relation(fields: [tenantId], references: [id])
}

model Lead {
  id                String             @id @default(uuid())
  tenantId          String
  companyName       String
  contactEmail      String[]
  contactName       String?
  contactPhone      String[]
  status            LeadStatus         @default(FOLLOW_UP)
  confidence        Float?
  metadata          Json?
  createdAt         DateTime           @default(now())
  deletedAt         DateTime?
  contactAddress    String[]
  source            lead_source        @default(AI_GENERATED)
  linkedInUrl       String?            @unique
  companySize       Int?               @default(0)
  jobId             String?
  description       String?
  bulkEmailJobLeads BulkEmailJobLead[]
  campaignLeads     CampaignLead[]
  EmailMessage      EmailMessage[]
  LeadGenerationJob LeadGenerationJob? @relation(fields: [jobId], references: [id])
  tenant            Tenant             @relation(fields: [tenantId], references: [id])

  @@unique([jobId, contactEmail], map: "Lead_jobId_email_key")
  @@index([tenantId, status])
  @@index([jobId])
}

model DomainIdentity {
  id                 String          @id @default(uuid())
  tenantId           String
  domainName         String          @unique
  verificationToken  String?
  verificationStatus String          @default("Pending")
  dkimTokens         String[]
  createdAt          DateTime        @default(now())
  verifiedAt         DateTime?
  deletedAt          DateTime?
  dkimRecords        Json            @default("[]")
  tenant             Tenant          @relation(fields: [tenantId], references: [id])
  emailIdentities    EmailIdentity[]
}

model EmailIdentity {
  id                 String         @id @default(uuid())
  domainId           String
  emailAddress       String         @unique
  verificationStatus String         @default("Pending")
  createdAt          DateTime       @default(now())
  verifiedAt         DateTime?
  deletedAt          DateTime?
  domain             DomainIdentity @relation(fields: [domainId], references: [id])
}

model Variable {
  id           String        @id @default(uuid())
  key          String
  defaultValue String?
  templateId   String
  template     EmailTemplate @relation(fields: [templateId], references: [id])
}

model EmailTemplate {
  id            String          @id @default(uuid())
  tenantId      String
  name          String
  subject       String
  body          String
  from_         String          @map("from")
  to            String
  createdAt     DateTime        @default(now())
  deletedAt     DateTime?
  bulkEmailJobs BulkEmailJob[]
  campaigns     EmailCampaign[]
  tenant        Tenant          @relation(fields: [tenantId], references: [id])
  variable      Variable[]
}

model EmailCampaign {
  id            String         @id @default(uuid())
  tenantId      String
  templateId    String
  scheduledAt   DateTime?
  createdAt     DateTime       @default(now())
  status        CampaignStatus @default(DRAFT)
  name          String
  description   String?
  campaign_type CampaignType
  bulkEmailJobs BulkEmailJob[]
  campaignLeads CampaignLead[]
  template      EmailTemplate  @relation(fields: [templateId], references: [id])
  tenant        Tenant         @relation(fields: [tenantId], references: [id])
  EmailMessage  EmailMessage[]
}

model BulkEmailJob {
  id              String             @id @default(uuid())
  tenantId        String
  templateId      String?
  campaignId      String?
  rateLimit       Int
  status          BulkEmailJobStatus @default(QUEUED)
  progress        Int                @default(0)
  total           Int                @default(0)
  nextProcessTime DateTime?
  createdAt       DateTime           @default(now())
  startedAt       DateTime?
  completedAt     DateTime?
  lastProcessedAt DateTime?
  campaign        EmailCampaign?     @relation(fields: [campaignId], references: [id])
  template        EmailTemplate?     @relation(fields: [templateId], references: [id], onDelete: Restrict)
  tenant          Tenant             @relation(fields: [tenantId], references: [id])
  jobLeads        BulkEmailJobLead[]

  @@index([tenantId, status])
  @@index([status, nextProcessTime])
}

model BulkEmailJobLead {
  id       String       @id @default(uuid())
  jobId    String
  leadId   String
  status   EmailStatus  @default(QUEUED)
  attempts Int          @default(0)
  sentAt   DateTime?
  job      BulkEmailJob @relation(fields: [jobId], references: [id])
  lead     Lead         @relation(fields: [leadId], references: [id])

  @@unique([jobId, leadId])
}

model LeadGenerationJob {
  id             String    @id @default(uuid())
  tenantId       String
  prompt         String?
  industry       String?
  location       String?
  status         String    @default("QUEUED")
  batchId        String?
  createdAt      DateTime  @default(now())
  completedAt    DateTime?
  totalRequested Int
  generatedCount Int       @default(0)
  urls           String[]  @default([])
  Lead           Lead[]
  tenant         Tenant    @relation(fields: [tenantId], references: [id])

  @@index([tenantId, status])
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model BulkSnippet {
  id         String   @id(map: "bulk_snippet_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id  String
  text       String
  created_at DateTime @default(now()) @db.Timestamptz(6)
  Tenant     Tenant   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "bulk_snippet_tenant_id_fkey")
}

model CompanyProfile {
  id                   String      @id(map: "company_profile_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id            String      @unique(map: "company_profile_tenant_id_key")
  description          String?
  mission              String?
  values               String?
  usp                  String?
  history              String?
  key_personnel        String?
  created_at           DateTime    @default(now()) @db.Timestamptz(6)
  updated_at           DateTime    @default(now()) @db.Timestamptz(6)
  offering_description String?
  target_market        String?
  Tenant               Tenant      @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "company_profile_tenant_id_fkey")
  CompanyQA            CompanyQA[]
  Product              Product[]
}

model CompanyQA {
  id             String         @id(map: "company_qa_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  company_id     String         @db.Uuid
  question       String
  answer         String
  category       String?
  CompanyProfile CompanyProfile @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "company_qa_company_id_fkey")

  @@index([company_id, category], map: "idx_company_qa_company_category")
}

model KnowledgeDocument {
  id             String    @id(map: "knowledge_document_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id      String
  file_key       String
  filename       String
  mime_type      String
  size_bytes     Int?
  status         String    @default("UPLOADED")
  extracted_text String?
  created_at     DateTime  @default(now()) @db.Timestamptz(6)
  processed_at   DateTime? @db.Timestamptz(6)
  Tenant         Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "knowledge_document_tenant_id_fkey")

  @@index([tenant_id, status], map: "idx_knowledge_document_status")
}

model PaymentTransaction {
  id             String       @id @default(dbgenerated("(gen_random_uuid())::text"))
  tenantId       String
  subscriptionId String
  providerId     String       @unique(map: "paymenttransaction_providerid_unique")
  amount         Int
  status         String       @default("INITIATED")
  createdAt      DateTime     @default(now()) @db.Timestamptz(6)
  invoiceId      String?
  invoiceUrl     String?
  paymentId      String?
  Subscription   Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_paymenttransaction_subscription")
  Tenant         Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_paymenttransaction_tenant")
}

model Product {
  id              String         @id(map: "product_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  company_id      String         @db.Uuid
  name            String         @db.VarChar(120)
  category        String?
  description     String?
  features        String?
  benefits        String?
  pricing         String?
  target_audience String?
  use_cases       String?
  created_at      DateTime       @default(now()) @db.Timestamptz(6)
  updated_at      DateTime       @default(now()) @db.Timestamptz(6)
  CompanyProfile  CompanyProfile @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "product_company_id_fkey")
  ProductQA       ProductQA[]
}

model ProductQA {
  id         String  @id(map: "product_qa_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  product_id String  @db.Uuid
  question   String
  answer     String
  Product    Product @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "product_qa_product_id_fkey")
}

model WebsiteContent {
  id            String    @id(map: "website_content_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id     String
  url           String
  title         String?
  status        String    @default("PENDING")
  crawl_summary String?
  added_at      DateTime  @default(now()) @db.Timestamptz(6)
  finished_at   DateTime? @db.Timestamptz(6)
  Tenant        Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "website_content_tenant_id_fkey")

  @@index([tenant_id, status], map: "idx_website_content_status")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model TenantRAG {
  id         String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id  String
  source     String
  sourceId   String
  embedding  Unsupported("vector")?
  created_at DateTime               @default(now()) @db.Timestamptz(6)

  @@unique([tenant_id, source, sourceId], map: "tenantrag_unique_tenant_source_sourceid")
  @@index([embedding])
  @@index([tenant_id], map: "idx_tenant_rag_tenant_id")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Feedback {
  id         String           @id @default(dbgenerated("(gen_random_uuid())::text"))
  tenant_id  String
  name       String
  email      String?
  category   FeedbackCategory @default(GENERAL_COMMENT)
  rating     Int?
  page       String?
  message    String
  created_at DateTime         @default(now()) @db.Timestamptz(6)
  Tenant     Tenant           @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_feedback_tenant")

  @@index([tenant_id, category], map: "idx_feedback_tenant_category")
  @@index([tenant_id, created_at], map: "idx_feedback_tenant_created_at")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model TenantOnboarding {
  tenant_id     String             @id
  role          OnboardingRole
  hear_about_us AcquisitionChannel
  primary_goal  SalesGoal
  createdat     DateTime           @default(now()) @db.Timestamptz(6)
  updated_at    DateTime           @default(now()) @db.Timestamptz(6)
  Tenant        Tenant             @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model WaitListMembers {
  id              String   @id(map: "wait_list_members_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name            String
  email           String   @unique(map: "wait_list_members_email_key")
  whatsapp_number String
  created_at      DateTime @default(now()) @db.Timestamptz(6)
}

model GeneratedEmail {
  id             String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  subject        String
  content        String
  createdAt      DateTime      @default(now()) @db.Timestamp(6)
  scheduledDate  DateTime?     @db.Timestamp(6)
  emailMessageId String?       @db.Uuid
  EmailMessage   EmailMessage? @relation(fields: [emailMessageId], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Conversation {
  id             String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId       String
  threadKey      String
  subject        String?
  participants   String[]       @default([])
  firstMessageAt DateTime       @default(now()) @db.Timestamptz(6)
  lastMessageAt  DateTime       @default(now()) @db.Timestamptz(6)
  createdAt      DateTime       @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime       @default(now()) @db.Timestamptz(6)
  Tenant         Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "conversation_tenant_fkey")
  EmailMessage   EmailMessage[]

  @@unique([tenantId, threadKey], map: "conversation_tenant_threadkey_uq")
  @@index([tenantId, lastMessageAt], map: "conversation_tenant_lastMessageAt_idx")
}

model EmailMessage {
  id                 String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId           String
  conversationId     String           @db.Uuid
  direction          email_direction
  provider           String           @default("AWS_SES")
  providerMessageId  String
  subject            String?
  from_              String[]         @default([]) @map("from")
  to                 String[]         @default([])
  cc                 String[]         @default([])
  bcc                String[]         @default([])
  text               String?
  html               String?
  headers            Json?
  verdicts           Json?
  inReplyTo          String?
  referencesIds      String[]
  plusToken          String?
  s3Bucket           String?
  s3Key              String?
  receivedAt         DateTime?        @db.Timestamptz(6)
  sentAt             DateTime?        @db.Timestamptz(6)
  createdAt          DateTime         @default(now()) @db.Timestamptz(6)
  campaignId         String?
  leadId             String?
  lastDeliveryStatus String?
  firstOpenedAt      DateTime?        @db.Timestamptz(6)
  opensCount         Int?             @default(0)
  clicksCount        Int?             @default(0)
  lastEventAt        DateTime?        @db.Timestamptz(6)
  EmailEvent         EmailEvent[]
  EmailCampaign      EmailCampaign?   @relation(fields: [campaignId], references: [id], onUpdate: NoAction, map: "emailmessage_campaign_fkey")
  Conversation       Conversation     @relation(fields: [conversationId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "emailmessage_conversation_fkey")
  Lead               Lead?            @relation(fields: [leadId], references: [id], onUpdate: NoAction, map: "emailmessage_lead_fkey")
  Tenant             Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "emailmessage_tenant_fkey")
  GeneratedEmail     GeneratedEmail[]

  @@unique([tenantId, providerMessageId], map: "emailmessage_tenant_providerMessageId_uq")
  @@index([tenantId, conversationId, createdAt], map: "emailmessage_tenant_conv_createdAt_idx")
  @@index([tenantId, inReplyTo], map: "emailmessage_tenant_inReplyTo_idx")
}

model InboundReceipt {
  id                String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId          String
  snsMessageId      String    @unique
  providerMessageId String
  s3Bucket          String
  s3Key             String
  status            String
  error             String?
  receivedAt        DateTime  @default(now()) @db.Timestamptz(6)
  processedAt       DateTime? @db.Timestamptz(6)
  Tenant            Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "inboundreceipt_tenant_fkey")

  @@index([tenantId, receivedAt], map: "inboundreceipt_tenant_receivedAt_idx")
}

model AppEvent {
  event_id      String   @id(map: "app_event_pkey") @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  occurred_at   DateTime @db.Timestamptz(6)
  received_at   DateTime @default(now()) @db.Timestamptz(6)
  event_name    String
  user_id       String?
  anonymous_id  String?
  session_id    String?
  tenant_id     String?
  source        String?
  page_url      String?
  referrer      String?
  ip            String?  @db.Inet
  user_agent    String?
  properties    Json     @default("{}")
  context       Json     @default("{}")
  event_version Int      @default(1) @db.SmallInt
  schema_key    String?

  @@index([event_name, occurred_at(sort: Desc)], map: "idx_app_event_name_time")
  @@index([occurred_at], map: "idx_app_event_time")
  @@index([user_id, occurred_at(sort: Desc)], map: "idx_app_event_user_time")
}

model EmailEvent {
  id                String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId          String
  emailMessageId    String       @db.Uuid
  providerMessageId String
  eventType         String
  occurredAt        DateTime     @db.Timestamptz(6)
  snsMessageId      String       @unique
  payload           Json         @default("{}")
  createdAt         DateTime     @default(now()) @db.Timestamptz(6)
  EmailMessage      EmailMessage @relation(fields: [emailMessageId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([emailMessageId], map: "idx_emailevent_emailmessage")
  @@index([providerMessageId], map: "idx_emailevent_provider")
  @@index([tenantId, eventType], map: "idx_emailevent_tenant_eventtype")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model UsageCounter {
  tenantId       String
  subscriptionId String
  metric         MeterMetric
  windowType     CapPeriod
  windowStart    DateTime     @db.Timestamptz(6)
  windowEnd      DateTime?    @db.Timestamptz(6)
  qty            Int          @default(0)
  updatedAt      DateTime     @default(now()) @db.Timestamptz(6)
  Subscription   Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "UsageCounter_subscription_fkey")
  Tenant         Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "UsageCounter_tenant_fkey")

  @@id([tenantId, subscriptionId, metric, windowType, windowStart])
  @@index([tenantId, metric, windowType, windowStart], map: "UsageCounter_lookup_idx")
}

model WebhookEvent {
  eventId     String    @id
  provider    String
  eventType   String
  receivedAt  DateTime  @default(now()) @db.Timestamptz(6)
  processed   Boolean   @default(false)
  processedAt DateTime? @db.Timestamptz(6)
}

model identity_link {
  anonymous_id String
  user_id      String
  linked_at    DateTime @default(now()) @db.Timestamptz(6)

  @@id([anonymous_id, user_id])
}

model CalendarConnection {
  id           String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId     String
  userId       String
  provider     CalendarProvider
  accountEmail String
  accessToken  String
  refreshToken String?
  expiresAt    DateTime?        @db.Timestamptz(6)
  scope        String?
  createdAt    DateTime         @default(now()) @db.Timestamptz(6)
  updatedAt    DateTime         @default(now()) @db.Timestamptz(6)
  Tenant       Tenant           @relation(fields: [tenantId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "CalendarConnection_tenant_fkey")
  User         User             @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "CalendarConnection_user_fkey")

  @@unique([tenantId, userId, provider], map: "CalendarConnection_tenant_user_provider_uq")
  @@index([tenantId], map: "CalendarConnection_tenant_idx")
}

model CsvImportJob {
  id            String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId      String         @db.Uuid
  objectKey     String
  status        String         @default("QUEUED")
  importMode    ImportMode     @default(UPSERT)
  dedupePolicy  DedupePolicy   @default(EMAIL)
  delimiter     String?
  headerRow     Int?
  columnMapping Json?
  totalRows     Int            @default(0)
  processedRows Int            @default(0)
  duplicateRows Int            @default(0)
  failedRows    Int            @default(0)
  createdAt     DateTime       @default(now()) @db.Timestamptz(6)
  startedAt     DateTime?      @db.Timestamptz(6)
  completedAt   DateTime?      @db.Timestamptz(6)
  CsvImportRow  CsvImportRow[]

  @@index([tenantId, status], map: "idx_CsvImportJob_tenantId_status")
}

model CsvImportRow {
  id            String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  jobId         String           @db.Uuid
  rowNumber     Int
  rawData       Json
  status        RowProcessStatus @default(QUEUED)
  error         String?
  createdLeadId String?          @db.Uuid
  processedAt   DateTime?        @db.Timestamptz(6)
  retryCount    Int              @default(0)
  CsvImportJob  CsvImportJob     @relation(fields: [jobId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_CsvImportRow_jobId")

  @@index([jobId, rowNumber], map: "idx_CsvImportRow_jobId_rowNumber")
  @@index([jobId, status], map: "idx_CsvImportRow_jobId_status")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model MeetingBooking {
  id             String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  intentId       String         @db.Uuid
  finalStart     DateTime       @db.Timestamptz(6)
  finalEnd       DateTime       @db.Timestamptz(6)
  calendarSystem CalendarSystem
  eventId        String?
  icsUid         String?
  createdAt      DateTime       @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime       @default(now()) @db.Timestamptz(6)
  MeetingIntent  MeetingIntent  @relation(fields: [intentId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([intentId], map: "MeetingBooking_intent_idx")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model MeetingIntent {
  id             String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId       String
  conversationId String
  status         MeetingIntentStatus @default(OFFERED)
  createdAt      DateTime            @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime            @default(now()) @db.Timestamptz(6)
  MeetingBooking MeetingBooking[]
  MeetingOffer   MeetingOffer[]

  @@index([tenantId, conversationId], map: "MeetingIntent_tenant_conversation_idx")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model MeetingOffer {
  id            String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  intentId      String        @db.Uuid
  slotStart     DateTime      @db.Timestamptz(6)
  slotEnd       DateTime      @db.Timestamptz(6)
  recipientTz   String        @default("UTC")
  tokenHash     String?
  expiresAt     DateTime?     @db.Timestamptz(6)
  createdAt     DateTime      @default(now()) @db.Timestamptz(6)
  MeetingIntent MeetingIntent @relation(fields: [intentId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([intentId, slotStart, slotEnd], map: "MeetingOffer_unique_slot_per_intent")
}

enum PlanType {
  FREE
  PRO
  GROWTH
  STARTER
}

enum UserRole {
  SUPERADMIN
  ADMIN
  MANAGER
}

enum LeadStatus {
  NOT_INTERESTED
  FOLLOW_UP
  INTERESTED
  IMMEDIATE_ACTION
}

enum EmailStatus {
  QUEUED
  SENT
  OPENED
  CLICKED
  REPLIED
  BOUNCED
  FAILED
}

enum BulkEmailJobStatus {
  QUEUED
  PROCESSING
  COMPLETED
  PAUSED
  FAILED
}

enum CampaignStatus {
  DRAFT
  SCHEDULED
  ACTIVE
  COMPLETED
  CANCELLED
}

enum ZoneCode {
  IN
  US
  EU
  AE
  ROW
}

enum MeterMetric {
  JOB
  CLASSIFICATION
  SEAT
}

enum CapPeriod {
  DAY
  MONTH
  PERIOD
}

enum BillingCadence {
  MONTHLY
  YEARLY
}

enum Experiment {
  PUBLIC
  A
  B
  C
}

enum CampaignType {
  COLD_OUTREACH
  FOLLOW_UP_SEQUENCE
  LEAD_NURTURING
  RE_ENGAGEMENT
}

enum crawl_status {
  PENDING
  CRAWLING
  READY
  ERROR
}

enum document_status {
  UPLOADED
  PROCESSING
  READY
  ERROR
}

enum lead_source {
  AI_GENERATED
  CSV_UPLOAD
  MANUAL_ENTRY
}

enum AcquisitionChannel {
  GOOGLE_SEARCH
  SOCIAL_MEDIA
  REFERRAL
  ADVERTISEMENT
  BLOG
  OTHER
}

enum FeedbackCategory {
  BUG_REPORT
  FEATURE_REQUEST
  GENERAL_COMMENT
  TESTIMONIAL
  OTHER
}

enum OnboardingRole {
  FOUNDER_CEO
  SALES_MANAGER
  MARKETING_MANAGER
  BUSINESS_DEV
  OTHER
}

enum SalesGoal {
  INCREASE_LEADS
  IMPROVE_CONVERSION
  AUTOMATE_PROCESS
  BETTER_TRACKING
  TEAM_COLLABORATION
}

enum EmailType {
  MANUAL
  AI_GENERATED
  TEMPLATE
}

enum email_direction {
  INBOUND
  OUTBOUND
}

enum PaymentGateway {
  RAZORPAY
  STRIPE
  WISE
}

enum SubscriptionStatus {
  ACTIVE
  PAST_DUE
  CANCELED
  EXPIRED
  PENDING
}

enum CalendarProvider {
  GOOGLE
  MICROSOFT
}

enum CalendarSystem {
  GOOGLE
  MICROSOFT
  ICS
}

enum DedupePolicy {
  EMAIL
  LINKEDIN
  PHONE
  DOMAIN_PLUS_NAME
  NONE
}

enum ImportMode {
  INSERT_ONLY
  UPSERT
  DRY_RUN
}

enum MeetingIntentStatus {
  OFFERED
  CONFIRMED
  RESCHEDULED
  CANCELLED
}

enum RowProcessStatus {
  QUEUED
  PROCESSED
  DUPLICATE
  FAILED
  SKIPPED
}
